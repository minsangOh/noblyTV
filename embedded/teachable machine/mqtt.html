<!DOCTYPE html>
<html>
  <head>
    <title>MQTT Web Client Example</title>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js"
      type="text/javascript"
    ></script>
  </head>
  <body>
    <h1>MQTT Web Client Example</h1>
    <button id="connect">Connect</button>
    <button id="disconnect" disabled>Disconnect</button>
    <button id="sendMessage">Send Message</button>

    <script>
      var mqttClient;
      var connected = false;

      // Configuration
      var mqttBroker = "i10c103.p.ssafy.io"; // Change to your MQTT broker URL or IP
      var mqttPort = 9001; // Change to your MQTT broker WebSocket port
      var mqttTopic = "topic/id3/user"; // Change to your topic


      // btn : connect
      document.getElementById("connect").addEventListener("click", function () {
        // Create a client instance
        mqttClient = new Paho.MQTT.Client(mqttBroker, mqttPort, mqttTopic);

        // set callback handlers
        mqttClient.onConnectionLost = function (responseObject) {
          console.log("Connection lost: " + responseObject.errorMessage);
          connected = false;
          updateUI();
        };

        mqttClient.onMessageArrived = function (message) {
          console.log("Message Arrived: " + message.payloadString);
        };

        // called when the client connects
        mqttClient.connect({
          onSuccess: function () {
            console.log("Connected to " + mqttBroker + ":" + mqttPort);
            mqttClient.subscribe("topic/#");
            connected = true;
            updateUI();
          },
          onFailure: function (message) {
            console.log("Connection failed: " + message.errorMessage);
          },
        });
      });

      // btn : disconnect
      document
        .getElementById("disconnect")
        .addEventListener("click", function () {
          if (mqttClient) {
            mqttClient.disconnect();
            console.log("Disconnected");
            connected = false;
            updateUI();
          }
        });

      // btn : send message
      document
        .getElementById("sendMessage")
        .addEventListener("click", function () {
          if (mqttClient && connected) {
            var message = new Paho.MQTT.Message("Hello from topic/id3");
            message.destinationName = "topic/id3";
            mqttClient.send(message);
            console.log("Message sent: " + message.payloadString);
          } else {
            console.log("Cannot send message. Not connected.");
          }
        });

      function updateUI() {
        document.getElementById("connect").disabled = connected;
        document.getElementById("disconnect").disabled = !connected;
      }
    </script>
  </body>
</html>
